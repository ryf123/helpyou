<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
                            
    <title>HYACSIS-District</title>
    
    <!-- Bootstrap core CSS -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="vendors/bootstrap-datepicker.min.css" rel="stylesheet">
    <!-- MetisMenu CSS -->
    <link href="metisMenu/metisMenu.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="vendors/sb-admin-2.css" rel="stylesheet">
    <!-- Custom Fonts -->
    <link href="vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="bootstrap-editable/css/bootstrap-editable.css" rel="stylesheet">
    <link href="vendors/jquery.dataTables.min.css" rel="stylesheet">
    <link href="vendors/select2.min.css" rel="stylesheet">
    <link href="vendors/bootstrap-table.min.css" rel="stylesheet">
    
    <style type="text/css">
    body {
            padding-top: 50px;
            padding-bottom: 30px;
    }
    
    table.table > tbody > tr > td {
        height: 30px;
        vertical-align: middle;
    }
    /* address.js css style for address*/
    .editable-address {
        display: block;
        margin-bottom: 5px;
    }
    
    .editable-address span {
        width: 70px;
        display: inline-block;
    }
    </style>
</head>
<body class="nav-md" style="padding-top: 0px">
    <div id="wrapper">
        
        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <a class="navbar-brand" href="index.html">
                    <div class="row">
                        <div class="col-lg-1">
                            <img src="hyaclogo.png" class="img-circle" alt="Cinque Terre" width="25" height="25">
                        </div>
                        <div class="col-lg-11">
                            HelpYouAchieve Student Information System
                        </div>
                    </div>
                    </a>
            </div>
            <!-- /.navbar-header -->

            <ul class="nav navbar-top-links navbar-right">
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="#"><i class="fa fa-user fa-fw"></i> User Profile</a>
                        </li>
                        <li><a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href='#' id="signoutbutton"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
            <!-- /.navbar-top-links -->

            <div class="navbar-default sidebar" role="navigation" style="
                width: 220px;
                margin-top: 51px;
                ">
                <div class="sidebar-nav navbar-collapse" style="
                width: 220px;
                ">
                    <ul class="nav" id="side-menu">
                        
                        
                        <li>
                            <a href="index.html" style="
                                padding-left: 10px;
                                padding-right: 10px;
                                ">
                                <i class="fa fa-dashboard fa-fw"></i> Dashboard / 首页</a>
                        </li>
                        
                        
                        <!-- / Info inputs-->
                        <li>
                            <a href="#" style="
                                padding-left: 10px;
                                padding-right: 10px;
                                ">
                                <i class="fa fa-edit fa-fw"></i> Info Inputs / 信息录入<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li>
                                    <a href="districtform.html" style="
                                padding-left: 32px;
                                ">District Inputs / 学区信息</a>
                                </li>
                                <li>
                                    <a href="schoolform.html" style="
                                padding-left: 32px;
                                ">School Inputs / 学校信息</a>
                                </li>
                                <li>
                                    <a href="Studentinput.html" style="
                                padding-left: 32px;
                                ">Student Inputs / 学生信息</a>
                                </li>
                                <li>
                                    <a href="Registrationinput.html" style="
                                padding-left: 32px;
                                padding-right: 0px;
                                ">Registration Inputs / 注册信息</a>
                                </li>
                            </ul>
                            <!-- /.nav-second-level -->
                        </li>
                        <!-- /End of 1st - Info inputs-->
                        <li>
                            <a href="districtform.html" style="
                                padding-left: 10px;
                                padding-right: 10px;
                                ">
                                <i class="fa fa-home fa-fw"></i> District / 学区</a>
                        </li>
                        <li>
                            <a href="schooltable.html" style="
                                padding-left: 10px;
                                padding-right: 10px;
                                ">
                                <i class="fa fa-hospital-o fa-fw"></i> School / 学校</a>
                        </li>
                        <li>
                            <a href="studenttable.html" style="
                                padding-left: 10px;
                                padding-right: 10px;
                                ">
                                <i class="fa fa-users fa-fw"></i> Student / 学生</a>
                        </li>
                        <li>
                            <a href="Registrationinput.html" style="
                                padding-left: 10px;
                                padding-right: 10px;
                                ">
                                <i class="fa fa-pencil fa-fw"></i> Registration / 注册</a>
                        </li>
                        <li>
                            <a href="studentpickuptable.html" style="
                                padding-left: 10px;
                                padding-right: 10px;
                                ">
                                <i class="fa fa-th-list fa-fw"></i> Pickup Schedule / 接送安排</a>
                        </li>
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>
        <!--End of Heading-->

        <div id="page-wrapper" style="min-height: 260px;margin-left: 220px;boder-left-width: 0px;">
            <div class="row">
                <br>
                <div class="col-lg-1" style="padding-right: 0px; width:">
                    <img src="hyaclogo.png" class="img-circle" alt="Cinque Terre" width="55" height="55">
                        </div>
                <div class="col-lg-11">
                    <h3 class="text-primary" style="margin-top: 10px">HYACSIS - District Info Input</h3>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.End of 1st row -System Name -->
            <hr>
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-info">
                        <div class="panel-heading" style="padding-left: 30px;">District Information Input / 请输入学区信息                          
                        </div>
                        <div class="panel-body">
                            <form class="form-horizontal form-label-left" id="districtform">
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">School District / 学区 <span class="required">*</span></label>
                                    <div class="col-md-6 col-sm-6 col-xs-12">
                                        <select class="form-control" id='schooldistrict' name='schooldistrict'>
                                            <option value="PUSD">PUSD - Poway Unified School District</option>
                                            <option value="SDUSD">SDUSD - San Diego Unified School District</option>
                                            <option value="DMUSD">DMUSD - Del Mar Union School District</option>
                                            <option value="SBSD">SBSD - Solana Beach School District</option>
                                        </select>
                                        <span id="objectid" style="display:none;"/>
                                    </div>
                                </div>
                                <br>
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">District Calendar / 日历 <span class="required">*</span></label>
                                    <div class='col-md-6 col-sm-6 col-xs-12'>
                                        <div class='input-group date ' id='noschooldate' name='noschooldate'>
                                            <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                                            <input type='text' class="form-control" name="startDate" />
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12"></label>
                                    <div class='col-md-6 col-sm-6 col-xs-12'>
                                        <p class="text-info">请根据学区日历选择当前学年节假日并录入。<br>Please choose the No-School Dates from the above school district‘s Calendar for the current school year.</p>
                                    </div>
                                </div>
                            </form>
                            <!-- End of form -->
                            <hr>
                            <div class="col-lg-4"></div>
                            <div class="col-lg-4">
                                <span class="pull-left">
                                <button type="button" class="btn btn-outline btn-success" id="districtsave">Save / 保存</button>
                                </span>                                
                            </div>
                            <!-- Button -->
                        </div>
                    </div>
                </div> 
            </div>
            <!-- End of 2nd row - Info Inputs -->
            <hr style="margin-top: 0px;">            
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-info">
                        <div class="panel-heading" style="padding-left: 30px;">School District Table / 学区信息列表
                        </div>
                        <div class="panel-body">
                            <div class="col-lg-4" style="padding-left: 0px; padding-bottom: 15px;">
                                <span class="pull-left">
                                <button type="button" class="btn btn-outline btn-primary" id="districtrefresh">Refresh / 刷新</button>
                                </span>                                
                            </div>
                            <div >
                                <table id="table" style="word-wrap:break-word;table-layout: fixed;"></table>
                            </div>
                        </div>
                    </div>
                        <!-- End of panel-body -->
                </div>
            </div>
            <!-- End of 3rd row - Lists -->
        </div>
        <!-- /#page-wrapper -->
        
    </div>
    <!-- /#wrapper -->

    <!-- footer content -->
    <footer>
        <div class="">
            <p class="pull-right">Copyright ©2015 Evereast All Rights Reserved |
            <span class="lead"> <i class="fa fa-paw"></i> Evereast</span>
            </p>
        </div>
    </footer>
    <!-- /footer content -->    
    <!-- Custom styling plus plugins -->
    <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="vendors/wizard/jquery.smartWizard.js"></script>
    <script type="text/javascript" src="bootstrap-editable/js/moment.min.js"></script>
    <script src="vendors/bootstrap-datepicker.js"></script>
    <!-- Metis Menu Plugin JavaScript -->
    <script src="metisMenu/metisMenu.min.js"></script>
    <!-- Custom Theme JavaScript -->
    <script src="vendors/sb-admin-2.js"></script>
    <!-- momentjs -->
    <script src="vendors/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="vendors/parse.js"></script>
    <script src="vendors/bootstrap-table.min.js"></script>
    <script src="bootstrap-editable/js/bootstrap-editable.js"></script>
    <script src="vendors/select2.min.js"></script>
    <script src="bootstrap-editable/js/address.js"></script>

<style>
    .navbar-default {
        background-color: #d9edf7;
        border-color: #bce8f1;
    }
    .sidebar ul li a.active {
      background-color: #d9edf7;
    }
    .nav>li>a:focus, .nav>li>a:hover{
      text-decoration: none;
      background-color: #fff;
    }
    .sidebar ul li a.active {
      background-color: #fff;
    }
    .navbar-default .navbar-brand {
      color: #337ab7;
    }
    .panel-footer {
      background-color: #fff;
      border-top: 1px solid #fff;
    }
    body {
        background-color: #d9edf7;
    }
    .form-control {
      border: 1px solid #bce8f1;
    }
    .btn-default {
      color: #337ab7;
      background-color: #fff;
      border-color: #bce8f1;
    }
    body {
      color: #337ab7;
    }
</style>

    <script type="text/javascript">
            $(document).ready(function () {
                //initialize Parse
                Parse.initialize("IMxHY4AEmtrLwyxSSrBx7fVdPAyCqUCIVczJZPWl","vT6GeGbec8Do6EZ3Wdny68iFFitjBGjus6ZOjpu0");
                // initialize table, 
                // first load data from DB
                Parse.Cloud.run('getobject', {objectname: 'SchoolDistrict'}, {
                    success: function(districtdata){
                        var stringify_data = JSON.stringify(districtdata);
                        stringify_data = JSON.parse(stringify_data);
                        $('#table').bootstrapTable({
                            data: stringify_data,
                            columns: [
                                {
                                    field: 'districtname',
                                    title: "学区",
                                    width: "40%"

                                },
                                {
                                    field: 'districtnodate',
                                    title: "日历2",
                                    width: "60%"
                                }
                            ]
                        });
                    },
                    error: function(error){
                        cosole.log(error);
                    }
                });
                // enable date picker
                enabledatepicker();
                
                var currentdistrict = $("#schooldistrict").val();
                setcurrentdistrict(currentdistrict);
                $('#districtsave').click(function() {
                    var form = $("#districtform");
                    data = form.serializeArray();
                    myobjectvalue = {"districtname":data[0]["value"],"districtnodate":data[1]["value"]};
                    var objectid = $("#objectid")[0].innerHTML;
                    Parse.Cloud.run('saveobject', { objectname: 'SchoolDistrict', 'objectid':objectid,objectvalue:myobjectvalue}, {
                    success: function() {
                        alert("保存成功");
                    },
                    error: function(error) {
                        alert("Can't save, try again");
                    }
                });
                });

                // change datepicker on selection change 
                $('#schooldistrict').on('change', function() {
                    var currentdistrict = $(this).val();
                    setcurrentdistrict(currentdistrict);
                });
            });
            function enabledatepicker(){
                $("#noschooldate").datepicker({
                    startView: 1,
                    clearBtn: true,
                    multidate: true,
                    daysOfWeekDisabled: "0,6",
                });
            }
            function setcurrentdistrict(currentdistrict){
                    var noschooldate = $("#noschooldate").val();
                    Parse.Cloud.run('getobjectwithkeyequal',{objectname:"SchoolDistrict",keyname:"districtname",stringval:currentdistrict},{
                        success(district){
                            if(district.length != 0){
                                district = JSON.parse(JSON.stringify(district))[0];
                                if(district["districtnodate"] != undefined){
                                    $("#objectid")[0].innerHTML = district["objectId"]; 
                                    var datearray = [];
                                    var nodatearray = district["districtnodate"].split(",");
                                    for (var i = 0; i < nodatearray.length; i++){
                                        if(nodatearray[i] != ""){
                                            datearray.push(new Date(nodatearray[i]))
                                    }
                                }
                                if(datearray.length > 0){
                                    $("#noschooldate").datepicker('setDate',datearray);
                                }
                                }
                            }
                            else{
                               $("#objectid")[0].innerHTML = ""; 
                               $("#noschooldate").datepicker('setDate',null); 
                            }
                        },
                        error(error){
                            console.log(error);
                        }
                    });
            }
    </script>
</body>
    <style>

    </style>
</html>