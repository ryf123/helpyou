<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <!-- Bootstrap Core CSS -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="vendors/bootstrap-datepicker.min.css" rel="stylesheet">
    <!-- MetisMenu CSS -->
    <link href="metisMenu/metisMenu.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="vendors/sb-admin-2.css" rel="stylesheet">
    <!-- Custom Fonts -->
    <link href="vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="vendors/bootstrap-table.min.css" rel="stylesheet">
    <!-- add 2 new -->
    <link href="vendors/jquery.dataTables.min.css" rel="stylesheet">
    <link href="vendors/select2.min.css" rel="stylesheet">
    <!-- Latest compiled and minified js -->
        
        
    <title>HYACSIS-Schools</title>

</head>
<body class="nav-md" style="padding-top: 0px">
    <div id="wrapper">
        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0; height: 51px;">
            <div class="navbar-header">
                <a class="navbar-brand" href="index.html">
                    <div class="row">
                        <div class="col-lg-1">
                            <img src="hyaclogo.png" class="img-circle" alt="Cinque Terre" width="25" height="25">
                        </div>
                        <div class="col-lg-11">
                            HelpYouAchieve Student Information System
                        </div>
                    </div>
                    </a>
            </div>
            <!-- /.navbar-header -->

            <ul class="nav navbar-top-links navbar-right">
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-envelope fa-fw"></i><span class="badge"></span>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-messages" id="messages">
                        
                        <li>
                            <a class="text-center" href="hotlinenotification.html">
                                <strong>Read All Messages</strong>

                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                </li>
                <!-- /.dropdown-messages -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href='#' id="signoutbutton"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                        </li>
                    </ul>
                </li>
                <!-- /.dropdown-user -->
            </ul>
            <!-- /.navbar-top-links -->

            <div class="navbar-default sidebar" role="navigation" style="width: 220px; margin-top: 51px;">
                <div class="sidebar-nav navbar-collapse" style="width: 220px;">
                    <ul class="nav" id="side-menu">
                        <li><a href="index.html" style="padding-left: 10px; padding-right: 10px;">
                                <i class="fa fa-dashboard fa-fw"></i> Dashboard / 首页</a></li>
                        <li><a href="hotlinenotification.html" style="padding-left: 10px; padding-right: 10px;">
                                <i class="fa fa-envelope fa-fw"></i> Hotline / 出勤热线</a></li>
                        <!-- / Info inputs-->
                        <li>
                            <a href="#" style="padding-left: 10px; padding-right: 10px;">
                                <i class="fa fa-edit fa-fw"></i> Info Inputs / 信息录入<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li><a href="districtform.html" style="padding-left: 32px;">District Inputs / 学区信息</a></li>
                                <li><a href="schoolform.html" style="padding-left: 32px;">School Inputs / 学校信息</a></li>
                                <li><a href="Studentform.html" style="padding-left: 32px;">Student Inputs / 学生信息</a></li>
                                <li><a href="Registrationinput.html" style="padding-left: 32px; padding-right: 0px;">Registration Inputs / 注册信息</a></li>
                            </ul>
                            <!-- /.nav-second-level -->
                        </li>
                        <!-- /End of 1st - Info inputs-->
                        <li><a href="districtform.html" style="padding-left: 10px; padding-right: 10px;">
                            <i class="fa fa-home fa-fw"></i> District / 学区</a></li>
                        <li><a href="schooltable.html" style="padding-left: 10px; padding-right: 10px;">
                                <i class="fa fa-hospital-o fa-fw"></i> School / 学校</a></li>
                        <li><a href="studenttable.html" style="padding-left: 10px; padding-right: 10px;">
                                <i class="fa fa-users fa-fw"></i> Student / 学生</a></li>
                        <li><a href="Registrationinput.html" style="padding-left: 10px; padding-right: 10px;">
                                <i class="fa fa-pencil fa-fw"></i> Registration / 注册</a></li>
                        <li><a href="studentpickuptable.html" style="padding-left: 10px; padding-right: 10px;">
                                <i class="fa fa-th-list fa-fw"></i> Pickup Schedule / 接送安排</a></li>
                        <li><a href="studentsignintable.html" style="padding-left: 10px; padding-right: 10px;">
                                <i class="fa fa-check-square-o fa-fw"></i> Student Sign In / 学生签到</a></li>
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>
        <!--End of Navigation-->

        <div id="page-wrapper" style="min-height: 260px;margin-left: 220px;boder-left-width: 0px;">
            <div class="row">
                <br>
                <div class="col-lg-1" style="padding-right: 0px; width:">
                    <img src="hyaclogo.png" class="img-circle" alt="Cinque Terre" width="55" height="55">
                        </div>
                <div class="col-lg-11">
                    <h3 class="text-primary" style="margin-top: 10px">HYACSIS - School Information</h3>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.End of 1st row -System Name -->
            <hr>
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-info">
                        <div class="panel-heading" style="padding-left: 30px;">School Information / 学校信息</div>
                        <div class="panel-body">
                            <table id="table" data-show-footer="true"></table>
                        </div>
                    </div>
                    <!-- End of Panel -->
                </div>
            </div>
            <!-- End of 2nd row -->
        </div>
        <!-- End of Page Wrapper -->
    </div>
    <!-- End of wrapper -->
    
    <!-- footer content -->
    <footer>
        <div class="">
            <p class="pull-right">Copyright ©2015 Evereast All Rights Reserved |
            <span class="lead"> <i class="fa fa-paw"></i> Evereast</span>
            </p>
        </div>
    </footer>
    <!-- /footer content --> 
    <!-- jQuery -->
    <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="bootstrap/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="metisMenu/metisMenu.min.js"></script>
    <!-- Custom Theme JavaScript -->
    <script src="vendors/sb-admin-2.js"></script>
    <script src="vendors/bootstrap-table.min.js"></script>
    <script type="text/javascript" src="vendors/parse.js"></script>
    <script src="bootstrap-editable/js/bootstrap-editable.js"></script>
    <script src="bootstrap-editable/js/moment.min.js"></script>
    <script src="vendors/bootstrap-datepicker.js"></script>
    <script src="vendors/jquery.dataTables.min.js"></script>
    <script src="vendors/select2.min.js"></script>
    <script src="bootstrap-editable/js/address.js"></script>

        
</body>

<style>
.navbar-default {
    background-color: #d9edf7;
    border-color: #bce8f1;
}
.sidebar ul li a.active {
  background-color: #d9edf7;
}
.nav>li>a:focus, .nav>li>a:hover{
  text-decoration: none;
  background-color: #fff;
}
.sidebar ul li a.active {
  background-color: #fff;
}
.navbar-default .navbar-brand {
  color: #337ab7;
}
.panel-footer {
  background-color: #fff;
  border-top: 1px solid #fff;
}
body {
    background-color: #d9edf7;
}
.form-control {
  border: 1px solid #bce8f1;
}
.btn-default {
  color: #337ab7;
  background-color: #fff;
  border-color: #bce8f1;
}
body {
  color: #337ab7;
}
</style>

    <script>
        // load initial data from database
        Parse.initialize("IMxHY4AEmtrLwyxSSrBx7fVdPAyCqUCIVczJZPWl","vT6GeGbec8Do6EZ3Wdny68iFFitjBGjus6ZOjpu0");
        Parse.Cloud.run('getobject', {objectname: "School"}, {
                        success: function(schooldata) {
                        var stringify_data = JSON.stringify(schooldata);
                        stringify_data = JSON.parse(stringify_data);
                        $('#table').bootstrapTable({
                           search : 'true',
                           data: stringify_data,
                           columns: [
                                     {
                                     field: 'schoolname',
                                     title: '学校',
                                     sortable:'true',
                                     footerFormatter: totalNameFormatter
                                     },
                                     {
                                     field: 'schooldistrict',
                                     title: '学区',
                                     sortable:'true'
                                     },
                                     {
                                     field: 'phonenumber',
                                     title: '联系电话',
                                     sortable:'true'
                                     },
                                     {
                                     field: 'schooladdress',
                                     title: '地址',
                                     sortable:'true'
                                     },
                                     {
                                     field: 'schoolcity',
                                     title: '城市',
                                     sortable:'true'
                                     },
                                     {
                                     field: 'schoolzip',
                                     title: '邮编',
                                     sortable:'true'
                                     },
                                     {
                                     field: 'schoolwebsite',
                                     title: '网站',
                                     sortable:'true'
                                     },
                                     {
                                     field: 'GrDismissalTime',
                                     title: '1-5年级正常放学时间',
                                     sortable:'true'
                                     },
                                     {
                                     field: 'GtbdDTWD',
                                     title: '1-5年级早放学日-星期',
                                     sortable:'true'
                                     },
                                     {
                                     field: 'GtbdDismissalTime',
                                     title: '1-5年级早放学日-时间',
                                     sortable:'true'
                                     },
                                     {
                                     field: 'GtbdDismissalTimedate',
                                     title: '1-5年级早放学日-日期',
                                     sortable:'true'
                                     },
                                     {
                                     field: 'Kintroductorydays',
                                     title: 'K体验月',
                                     sortable:'true'
                                     },
                                     {
                                     field: 'KIDSDismissalTime',
                                     title: 'K体验月放学时间',
                                     sortable:'true'
                                     },
                                     {
                                     field: 'KrDismissalTime',
                                     title: 'K正常放学时间',
                                     sortable:'true'
                                     },
                                     {
                                     field: 'KtbdDTWD',
                                     title: 'K早放学日-星期',
                                     sortable:'true'
                                     },
                                     {
                                     field: 'KtbdDismissalTime',
                                     title: 'K早放学日-时间',
                                     sortable:'true'
                                     },
                                     {
                                     field: 'KtbdDismissalTimedate',
                                     title: 'K早放学日-日期',
                                     sortable:'true'
                                     },
                                     {
                                     field: 'TKDismissalTime',
                                     title: 'TK放学时间',
                                     sortable:'true'
                                     },
                                     
                                     {
                                     field: 'schoolprincipal',
                                     title: '校长',
                                     sortable:'true'
                                     },
                                     {
                                     field: 'schoolemail',
                                     title: '电邮',
                                     sortable:'true'
                                     },                                     
                                     {
                                     field: 'operate',
                                     title: '保存',
                                     formatter:"operatesaveFormatter",
                                     events:"operateEvents"
                                     },
                                     ]
                           });
                        var tabledata = $('#table').bootstrapTable("getData");
                        // loop through tr elements
                        var i= 0;
                        $('#table tr').each(function(){
                            // the first row is table head, skip it
                            if(i != 0){
                            var registerdate = "";
                            var schoolerdate = $('#table').bootstrapTable("getData")[i-1]["schoolerdate"];
                            if(schoolerdate != undefined){
                            $(this).find(".schoolerdate")[0].innerHTML = schoolerdate;
                            }
                            }
                            i++;
                         });
						 $('#table .schoolerdate').datepicker({
                                                              startView: 1,
                                                              //startDate: "-1d",
                                                              //endDate: "+1y",
                                                              clearBtn: true,
                                                              multidate: true,
                                                              daysOfWeekDisabled: "0,6",
                        });
							$('#table .schoolerdate').datepicker()
								.on('changeDate', function(e){
									this.innerHTML = $(this).datepicker('getFormattedDate')
							});
                        // show the preselected date
                        $('#table .schoolerdate').datepicker()
                        .on('show', function(e){
                            var schoolerdatearray = this.innerHTML.split(",");
                            var datearray = [];
                            // if there is not date yet, then registerdate is undefined
                            if(schoolerdatearray[0] != "-"){
                            for (var i = 0; i < schoolerdatearray.length; i++){
                            datearray.push(new Date(schoolerdatearray[i]))
                            }
                            }
                            if(datearray.length != 0){
                            $(this).datepicker('setDate',datearray);
                            }
                            });
                  
                    },
                        error: function(error) {
                        alert("error");
                        }
        });

        if(Parse.User.current() == undefined){
            $(location).attr('href','login.html');
        }
        
        Parse.Cloud.run('getobjectwithkeyequal',{objectname:"Smsmessage",keyname:"read",stringval:"false"},{
            success: function(msgs){
                msgs = JSON.parse(JSON.stringify(msgs));
                for(index in msgs){
                    var msg = msgs[index];
                    console.log(msg);
                    mbody = msg["mbody"];
                    mfrom = msg["mfrom"];
                    msginfo = "<li><a href ='#'><div><strong>"+mfrom+"</strong></div><div>"+mbody+"</div></a></li><li class='divider'></li>";
                    $("#messages").append(msginfo);        
                }
                //change badge number
                $(".badge")[0].innerText = msgs.length;
            },
            error: function(error){
                console.log(error);
            }
        });
      $('#signoutbutton').click(function() {
        Parse.User.logOut();
        $(location).attr('href','login.html');
      }); 
      
        // draw the save button
        function operatesaveFormatter(value, row, index) {
            return [
                    '<a class="save" href="javascript:void(0)" title="save">',
                    '<i class="glyphicon glyphicon-ok"></i>',
                    '</a>'
                    ].join('');
        }
        // draw the delete button
        function operateremoveFormatter(value, row, index) {
            return [
                    '<a class="remove ml10" href="javascript:void(0)" title="remove">',
                    '<i class="glyphicon glyphicon-remove"></i>',
                    '</a>'
                    ].join('');
        }
        // edit button event
        window.operateEvents = {
            
            
            
            // Edit/save button Event
            'click .save': function (e, value, row, index) {
                var objectid = row["objectId"];
                var schoolerdate = $(this).parent().parent().find(".schoolerdate").html();
                var myobjectvalue = {};
                myobjectvalue["schoolerdate"] = schoolerdate;
                Parse.Cloud.run('saveobject', { objectname: 'School', 'objectid':objectid,objectvalue:myobjectvalue}, {
                                success: function() {
                                console.log("Saved!");
                                },
                                error: function(error) {
                                alert("Can't save, try again");
                                }
                                });
                                
            },
        };
        // this is used to display "Total:"+ number
        function totalNameFormatter(data) {
            return "Total : "+data.length;
        }
    </script>
</html>
